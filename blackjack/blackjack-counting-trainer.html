<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21點算牌練習器 - Bust the Casino</title>
    <meta name="description" content="使用Hi-Lo算牌法，透過這個互動工具練習快速準確地計算流水數(Running Count)。可自訂出牌速度，提升您的算牌技巧。">
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-heading: 'Montserrat', sans-serif;
            --font-body: 'Open Sans', sans-serif;
            --color-bg-primary: #1A1D24;
            --color-bg-secondary: #2C323A;
            --color-text-primary: #EAEAEA;
            --color-text-secondary: #a0aec0;
            --color-accent-blue: #4A90E2;
            --color-accent-gold: #F1C40F;
            --color-correct: #2ECC71;
            --color-incorrect: #E53E3E;
        }
        body { background-color: var(--color-bg-primary); color: var(--color-text-primary); font-family: var(--font-body); }
        h1, h2, h3 { font-family: var(--font-heading); font-weight: 900; letter-spacing: -0.025em; }
        .sticky-nav { position: sticky; top: 0; z-index: 50; backdrop-filter: blur(10px); background-color: rgba(26, 29, 36, 0.8); }
        .content-box { background-color: var(--color-bg-secondary); border-radius: 0.75rem; padding: 2rem; }
        .card-display-area {
            min-height: 250px; /* Increased height */
            background-color: #1a202c;
            border-radius: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .card {
            background-color: white; color: black; border-radius: 0.5rem;
            width: 120px; height: 168px; /* Slightly larger cards */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 3rem; font-weight: bold;
            box-shadow: 0 10px 15px rgba(0,0,0,0.3);
            position: relative;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .card .suit { font-size: 2.5rem; }
        .card.red { color: #D90429; }
        .action-button {
            background-color: var(--color-accent-blue); color: white;
            padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            font-weight: bold; text-transform: uppercase;
            transition: background-color 0.3s, transform 0.2s;
            cursor: pointer;
        }
        .action-button:hover { background-color: #357ABD; transform: translateY(-2px); }
        .action-button:disabled { background-color: #4A5568; cursor: not-allowed; }
        .form-input {
            background-color: #1A1D24;
            border: 2px solid #4A5568;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: var(--color-text-primary);
            text-align: center;
            font-size: 1.5rem;
            width: 100px;
        }
        #nav-brand-text { color: var(--color-accent-gold); }
    </style>
</head>
<body class="antialiased">
    <!-- Header -->
    <header class="sticky-nav border-b border-gray-700/50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="../index.html" class="flex items-center space-x-3">
                <img src="../assets/images/logo.png" alt="Bust the Casino Logo" style="height: 74px;">
                <span id="nav-brand-text" class="text-2xl font-black font-heading tracking-wider">BUST THE CASINO</span>
            </a>
            <div class="hidden md:flex space-x-8 items-center">
                <a href="../index.html#strategy" id="nav-strategy" class="text-gray-300 hover:text-white transition duration-300">策略中心</a>
                <div class="relative">
                    <button id="nav-tools-toggle" class="text-gray-300 hover:text-white transition duration-300 flex items-center">
                        <span id="nav-tools">實戰工具</span>
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="nav-tools-dropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 hidden">
                        <a href="blackjack-basic-strategy.html" id="dropdown-bj-strategy-chart" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">21點基礎策略表</a>
                        <a href="blackjack-strategy-trainer.html" id="dropdown-bj-trainer" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">21點策略練習</a>
                        <a href="blackjack-counting-trainer.html" id="dropdown-bj-counter" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">21點算牌練習</a>
                        <a href="../金錢卦.html" id="dropdown-money-div" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">周易金錢卦</a>
                    </div>
                </div>
                <a href="../index.html#about" id="nav-about" class="text-gray-300 hover:text-white transition duration-300">關於我們</a>
                <div id="language-selector" class="flex space-x-2">
                    <button data-lang="zh" class="p-1 opacity-75 hover:opacity-100 transition"><img src="https://placehold.co/30x20/e6273e/ffffff?text=ZH" alt="Chinese" class="w-6 rounded-sm"></button>
                    <button data-lang="en" class="p-1 opacity-75 hover:opacity-100 transition"><img src="https://placehold.co/30x20/0052b4/ffffff?text=EN" alt="English" class="w-6 rounded-sm"></button>
                </div>
            </div>
            <button id="mobile-menu-button" class="md:hidden focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="../index.html#strategy" id="mobile-nav-strategy" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">策略中心</a>
                <div>
                    <button id="mobile-nav-tools-toggle" class="w-full text-left text-gray-300 hover:bg-gray-700 hover:text-white flex justify-between items-center px-3 py-2 rounded-md text-base font-medium">
                        <span id="mobile-nav-tools">實戰工具</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="mobile-nav-tools-dropdown" class="pl-4 mt-1 space-y-1 hidden">
                        <a href="blackjack-basic-strategy.html" id="mobile-dropdown-bj-strategy-chart" class="block px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">21點基礎策略表</a>
                        <a href="blackjack-strategy-trainer.html" id="mobile-dropdown-bj-trainer" class="block px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">21點策略練習</a>
                        <a href="blackjack-counting-trainer.html" id="mobile-dropdown-bj-counter" class="block px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">21點算牌練習</a>
                        <a href="../金錢卦.html" id="mobile-dropdown-money-div" class="block px-3 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">周易金錢卦</a>
                    </div>
                </div>
                <a href="../index.html#about" id="mobile-nav-about" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">關於我們</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <a href="blackjack.html" id="back-to-blackjack" class="text-sm mb-6 inline-block" style="color: var(--color-accent-blue);">&larr; 返回21點專區</a>
        <div class="content-box max-w-2xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-black text-center">21點算牌練習器</h1>
            <p class="text-center my-4" style="color: var(--color-text-secondary);">使用 Hi-Lo 算牌法練習計算流水數 (Running Count)。</p>

            <div class="my-8 space-y-4 text-center">
                <label for="speed-slider" id="speed-label" class="block text-lg">出牌速度: 1.5 秒</label>
                <input type="range" id="speed-slider" min="0.5" max="3" value="1.5" step="0.1" class="w-64">
            </div>
            
            <div id="card-display-area" class="card-display-area my-8">
                <!-- Card will be displayed here -->
            </div>
            
            <div class="flex justify-center my-6 gap-x-4">
                <button id="start-counting-button" class="action-button">開始</button>
                <button id="stop-counting-button" class="action-button" disabled>停止</button>
            </div>
            
            <div id="result-area" class="text-center mt-8" style="display: none;">
                <h3 id="enter-count-label" class="text-xl font-bold mb-4">請輸入最終流水數:</h3>
                <input type="number" id="count-input" class="form-input">
                <button id="submit-count-button" class="action-button ml-4">提交</button>
                <p id="final-result" class="text-2xl font-bold mt-4 h-8"></p>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 mt-12 border-t border-gray-800">
        <div class="container mx-auto text-center text-sm" style="color: var(--color-text-secondary);">
            <p id="footer-copyright">&copy; 2025 Bust the Casino. 版權所有。</p>
            <p id="footer-disclaimer" class="mt-2">請理智博弈，注意風險。本網站內容僅供學術探討和娛樂參考。</p>
        </div>
    </footer>
    
    <script src="../languages.js"></script>
    <script src="../app.js"></script>
    <script>
        const suits = ['♥', '♦', '♣', '♠'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        
        const speedSlider = document.getElementById('speed-slider');
        const speedLabel = document.getElementById('speed-label');
        const startButton = document.getElementById('start-counting-button');
        const stopButton = document.getElementById('stop-counting-button');
        const cardDisplayArea = document.getElementById('card-display-area');
        const resultArea = document.getElementById('result-area');
        const countInput = document.getElementById('count-input');
        const submitButton = document.getElementById('submit-count-button');
        const finalResult = document.getElementById('final-result');

        let deck = [];
        let runningCount = 0;
        let timer;
        let isRunning = false;
        
        function createDeck() {
            let newDeck = [];
            for (const suit of suits) {
                for (const value of values) {
                    newDeck.push({ suit, value });
                }
            }
            return newDeck;
        }

        function shuffleDeck(deckToShuffle) {
            for (let i = deckToShuffle.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deckToShuffle[i], deckToShuffle[j]] = [deckToShuffle[j], deckToShuffle[i]];
            }
        }
        
        function getCountValue(card) {
            const value = card.value;
            if (['10', 'J', 'Q', 'K', 'A'].includes(value)) {
                return -1;
            } else if (['2', '3', '4', '5', '6'].includes(value)) {
                return 1;
            }
            return 0;
        }

        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = 'card';
            if (['♥', '♦'].includes(card.suit)) {
                cardEl.classList.add('red');
            }

            const valueSpan = document.createElement('span');
            valueSpan.textContent = card.value;

            const suitSpan = document.createElement('span');
            suitSpan.className = 'suit';
            suitSpan.textContent = card.suit;
            
            cardEl.appendChild(valueSpan);
            cardEl.appendChild(suitSpan);
            return cardEl;
        }

        function dealNextCard() {
            if (deck.length === 0) {
                stopCounting();
                return;
            }

            const card = deck.pop();
            runningCount += getCountValue(card);
            
            const newCardEl = createCardElement(card);
            
            if (cardDisplayArea.firstChild) {
                cardDisplayArea.replaceChild(newCardEl, cardDisplayArea.firstChild);
            } else {
                cardDisplayArea.appendChild(newCardEl);
            }
        }
        
        function startCounting() {
            if (isRunning) return;
            isRunning = true;
            
            deck = createDeck();
            shuffleDeck(deck);
            runningCount = 0;

            cardDisplayArea.innerHTML = '';
            resultArea.style.display = 'none';
            finalResult.textContent = '';
            countInput.value = '';
            
            startButton.disabled = true;
            stopButton.disabled = false;
            speedSlider.disabled = true;

            const speed = parseFloat(speedSlider.value) * 1000;
            dealNextCard();
            timer = setInterval(dealNextCard, speed);
        }

        function stopCounting() {
            if (!isRunning) return;
            isRunning = false;
            
            clearInterval(timer);
            cardDisplayArea.innerHTML = `<span class="text-2xl font-bold" style="color: var(--color-accent-gold);">練習結束</span>`;
            
            startButton.disabled = false;
            stopButton.disabled = true;
            speedSlider.disabled = false;
            
            resultArea.style.display = 'block';
        }

        function checkResult() {
            const userAnswer = parseInt(countInput.value);
            if (isNaN(userAnswer)) return;

            if (userAnswer === runningCount) {
                finalResult.textContent = `正確！流水數是 ${runningCount}。`;
                finalResult.style.color = 'var(--color-correct)';
            } else {
                finalResult.textContent = `錯誤。正確的流水數是 ${runningCount}。`;
                finalResult.style.color = 'var(--color-incorrect)';
            }
        }
        
        speedSlider.addEventListener('input', () => {
             const currentLang = document.documentElement.lang;
             const template = (translations[currentLang] && translations[currentLang].speedLabel) ? translations[currentLang].speedLabel : '出牌速度: {0} 秒';
             speedLabel.textContent = template.replace('{0}', parseFloat(speedSlider.value).toFixed(1));
        });

        startButton.addEventListener('click', startCounting);
        stopButton.addEventListener('click', stopCounting);
        submitButton.addEventListener('click', checkResult);
        countInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkResult();
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            const currentLang = document.documentElement.lang || 'zh';
            const template = (translations[currentLang] && translations[currentLang].speedLabel) ? translations[currentLang].speedLabel : '出牌速度: {0} 秒';
            speedLabel.textContent = template.replace('{0}', parseFloat(speedSlider.value).toFixed(1));
        });

    </script>
</body>
</html>

